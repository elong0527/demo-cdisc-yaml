---
title: "ODM XML Loading"
format:
  html:
    code-fold: false
execute:
  echo: true
  warning: false
---

## Introduction

Load ODM XML files as Polars DataFrames. 

Example ODM XML file <https://raw.githubusercontent.com/elong0527/demo-cdisc-yaml/refs/heads/main/data/odm/openclinica.xml> 

## Setup

```{python}
import sys
import os
sys.path.insert(0, os.path.abspath(".."))

import polars as pl
from src.odm import load
from reactable import Reactable, embed_css

pl.Config.set_tbl_rows(10)
embed_css()
```

## Common Schema 

- pro: output data always have common schema. 
- con: each value is a `struct`, need extra `unnest` step.

```{python}
file_path = "../data/odm/openclinica.xml"

# Load with hierarchical struct columns
df_dict = load.odm_xml_to_df_dict(file_path)
df_dict.head(5)
```

### Data Schema 

```{python}
df_dict.schema
```

## Different Schema 

```{python}
# Load flattened for analysis
df = load.odm_xml_to_df(file_path)
df.columns
```

### Data Exploration

```{python}
Reactable(df)
```

## Summary

The ODM loader provides:

- Smart naming (only duplicates get prefixes)
- Hierarchical or flattened output
- Automatic lowercase conversion
- Namespace cleaning