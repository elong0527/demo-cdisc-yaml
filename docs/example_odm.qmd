---
title: "ODM XML Loading"
format:
  html:
    code-fold: false
execute:
  echo: true
  warning: false
---

## Introduction

Load ODM XML files from OpenClinica into Polars DataFrames with smart column naming.

## Setup

```{python}
import sys
import os
sys.path.insert(0, os.path.abspath(".."))

import polars as pl
from src.odm import load
from reactable import Reactable, embed_css

pl.Config.set_tbl_rows(10)
embed_css()
```

## Basic Usage

```{python}
file_path = "../data/odm/openclinica.xml"

# Load with hierarchical struct columns
df_dict = load.odm_xml_to_df_dict(file_path)
Reactable(df_dict)
```

### Data Schema 

```{python}
df_dict.schema
```

```{python}
# Load flattened for analysis
df = load.odm_xml_to_df(file_path)
df.columns
```

## Data Exploration

```{python}
# Interactive table with key columns
cols = ["studyoid", "subjectkey", "studyeventoid", "formoid", "itemgroupoid", "itemoid", "value"]
Reactable(df.select(cols))
```

## Summary

The ODM loader provides:

- Smart naming (only duplicates get prefixes)
- Hierarchical or flattened output
- Automatic lowercase conversion
- Namespace cleaning